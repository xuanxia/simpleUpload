!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["react-upload"]=t():e["react-upload"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}({"./src/components/Upload.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=m(r("babel-runtime/regenerator")),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=r("react"),l=m(u),s=m(r("antd/lib/upload"));r("antd/lib/upload/style/css");var f=m(r("antd/lib/icon"));r("antd/lib/icon/style/css");var c=m(r("antd/lib/message"));r("antd/lib/message/style/css");var d=m(r("antd/lib/modal"));r("antd/lib/modal/style/css");var p=r("react-beautiful-dnd");function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e,t,r){var n=Array.from(e),a=n.splice(t,1),o=i(a,1)[0];return n.splice(r,0,o),n},b=function(e){function t(e){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.onDragEnd=function(e){var t=a.state.fileList;if(e.destination){var r=g(t,e.source.index,e.destination.index);a.setState({fileList:r},function(){a.getImages()})}},a.getImages=function(e){var t=a.props.onChange,r=[];a.state.fileList.map(function(e){return e.name&&r.push(e.name),null}),e&&(r=a.ArrayRemoveByValue(r,e)),t(r.join(";"))},a.getData=function(){return a.state.formData},a.getPreNextInfo=function(e){var t=a.state.fileList,r=0,n=!0,o=!0;return t.map(function(t,n){return t.name===e&&(r=n),null}),0===r&&(n=!1),r===t.length-1&&(o=!1),{currentIndex:r,needPre:n,needNext:o}},a.handleRemove=function(e){var t="";return e&&e.response?t=e.response.data:e&&e.name&&(t=e.name),a.getImages(t),!0},a.ArrayRemoveByValue=function(e,t){for(var r=0;r<e.length;r+=1)if(e[r]===t){e.splice(r,1);break}return e},a.mergeFileList=function(e){var t=[],r=function(e){var r=!1;return t.map(function(t){return t.uid===e.uid&&(r=!0),null}),r};return a.state.fileList.map(function(e){return r(e)||"done"===e.status&&t.push(e),null}),e.map(function(e){return r(e)||t.push(e),null}),t},a.beforeUpload=function(e,t){var o=a.state,i=a.props||{},u=i.maxSize,l=i.getSign,s=i.extraParam,f=i.totalNum,d=i.minWidth,p=i.maxWidth,m=i.minHeight,g=i.maxHeight,b={"image/jpg":"jpg","image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/bmp":"bmp","image/webp":"webp"};return new Promise(function(i,h){if(o.fileList.length+t.length>f)return c.default.warn("最多上传"+f+"张图片 还能上传"+(f-o.fileList.length)+"张"),h(),!1;if(!b[e.type])return c.default.error("只能上传图片文件，可以是jpg/png/gif/bmp/webp格式!"),h(),!1;if(e.size/1024>(u||2048))return c.default.error("图片大小不能超过"+(u||2048)+"kb!"),h(),!1;var v=URL.createObjectURL(e),y=document.createElement("img");y.onload=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),u=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}(n.default.mark(function t(){var o,u,f,v;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=y.width,u=y.height,f=function(){c.default.error("您上传的图片尺寸("+o+" * "+u+") 与要求不符 请重新上传"),h()},!d){t.next=6;break}if(!(o<d)){t.next=6;break}return f(),t.abrupt("return",!1);case 6:if(!p){t.next=10;break}if(!(o>p)){t.next=10;break}return f(),t.abrupt("return",!1);case 10:if(!m){t.next=14;break}if(!(u<m)){t.next=14;break}return f(),t.abrupt("return",!1);case 14:if(!g){t.next=18;break}if(!(u>g)){t.next=18;break}return f(),t.abrupt("return",!1);case 18:return t.next=20,l(b[e.type],o,u,s);case 20:if(v=t.sent){t.next=24;break}return h(),t.abrupt("return",!1);case 24:v.fileName=e.name,a.setState({formData:v},i);case 26:case"end":return t.stop()}},t,r)})),y.src=v})},a.handlePreview=function(e){var t=a.getPreNextInfo(e.name),r=t.currentIndex,n=t.needPre,o=t.needNext;a.setState({preview:!0,previewImage:e.url||e.thumbUrl,currentIndex:r,needPre:n,needNext:o})},a.handlePreviewClose=function(){a.setState({preview:!1})},a.showNextImage=function(e){var t=a.state.fileList[e+1],r=a.getPreNextInfo(t.name),n=r.currentIndex,o=r.needPre,i=r.needNext;a.setState({previewImage:t.url||t.thumbUrl,currentIndex:n,needPre:o,needNext:i})},a.showPreImage=function(e){var t=a.state.fileList[e-1],r=a.getPreNextInfo(t.name),n=r.currentIndex,o=r.needPre,i=r.needNext;a.setState({previewImage:t.url||t.thumbUrl,currentIndex:n,needPre:o,needNext:i})},a.uploadButton=function(){var e=a.state.loading;return l.default.createElement("div",{className:"d-ib"},l.default.createElement(f.default,{style:{fontSize:28},type:e?"loading":"plus"}),l.default.createElement("div",{className:"ant-upload-text"},"上传图片"))},a.handleChange=function(e){var t=a.props.type,r=e.file,n=e.fileList;if(a.setState({fileList:a.mergeFileList(n)}),"uploading"!==r.status){if("done"===r.status){var o=!0;if("oss"===t){var i=r.response.data;n.map(function(e,t){return e.name===r.name&&(n[t].name=i.key),"done"!==e.status&&(o=!1),null})}if("qiniu"===t){var u=r.response;n.map(function(e,t){return e.name===r.name&&(n[t].name=u.key),"done"!==e.status&&(o=!1),null})}a.setState({loading:!1,fileList:a.mergeFileList(n)},function(){o&&a.getImages()})}}else a.setState({loading:!0})};var o=e.imageShowServiceHost,i=e.value,u=i?i.split(";"):[],s=[],d=[];return u&&u.length&&u.map(function(e,t){return s.push({uid:t,name:e,status:"done",thumbUrl:o+"/"+e,url:o+"/"+e}),d.push(e),null}),a.state={fileList:s,loading:!1,formData:{},preview:!1,previewImage:null,needPre:!0,needNext:!0,currentIndex:0},a.onDragEnd=a.onDragEnd.bind(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;document.removeEventListener("keyup",function(){}),document.addEventListener("keyup",function(t){var r=e.state,n=r.currentIndex,a=r.previewImage,o=r.fileList,i=t.key,u=t.code;"ArrowLeft"===i&&"ArrowLeft"===u&&a&&n>0&&e.showPreImage(n),"ArrowRight"===i&&"ArrowRight"===u&&a&&n<o.length-1&&e.showNextImage(n)})}},{key:"render",value:function(){var e=this.state,t=e.previewImage,r=e.fileList,n=e.currentIndex,a=e.needPre,i=e.needNext,u=e.preview,c=this.props,m=c.supportSort,g=c.totalNum,b={action:c.imageUploadServerHost,data:this.getData,beforeUpload:this.beforeUpload,onChange:this.handleChange,onRemove:this.handleRemove,fileList:r,listType:"picture-card",onPreview:this.handlePreview,multiple:g>1,className:"d-ib"},h={visible:u,title:"图片预览"+r.length+"/"+(n+1),footer:null,onCancel:this.handlePreviewClose},v={fontSize:30};return[l.default.createElement(s.default,o({key:"uploader"},b),r.length>=g?null:this.uploadButton()),l.default.createElement(d.default,o({key:"modal"},h),l.default.createElement("div",{style:{marginTop:-20,padding:"10px 0"}},a?l.default.createElement(f.default,{style:o({float:"left",color:"#40a9ff"},v),onClick:this.showPreImage.bind(this,n),type:"arrow-left"}):l.default.createElement(f.default,{style:o({float:"left",color:"#CDCDCD",cursor:"default"},v),type:"arrow-left"}),i?l.default.createElement(f.default,{style:o({float:"right",color:"#40a9ff"},v),onClick:this.showNextImage.bind(this,n),type:"arrow-right"}):l.default.createElement(f.default,{style:o({float:"right",color:"#CDCDCD",cursor:"default"},v),type:"arrow-right"})),l.default.createElement("img",{width:"100%",src:t,alt:""})),m&&r.length>1?l.default.createElement(p.DragDropContext,{key:"DragDropContext",onDragEnd:this.onDragEnd},l.default.createElement(p.Droppable,{droppableId:"droppable",direction:"horizontal"},function(e,t){return l.default.createElement("div",o({ref:e.innerRef,style:function(e){return{background:e?"lightblue":"lightgrey",display:"flex",padding:8,overflow:"auto"}}(t.isDraggingOver)},e.droppableProps),r.map(function(e,t){return l.default.createElement(p.Draggable,{key:e.uid,draggableId:e.uid,index:t},function(t,r){return l.default.createElement("div",o({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{style:function(e,t){return o({userSelect:"none",padding:4,margin:"0 8px 0 0",background:e?"lightgreen":"grey"},t)}(r.isDragging,t.draggableProps.style)}),l.default.createElement("img",{src:e.thumbUrl,width:50,height:50,alt:""}))})}),e.placeholder)})):""]}}]),t}();b.defaultProps={totalNum:1,value:"",onChange:function(){},supportSort:!1,maxSize:2048,imageShowServiceHost:"",imageUploadServerHost:"",getSign:function(){}},t.default=b},"./src/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r("react"),o=l(a),i=l(r("./src/components/Upload.js")),u=l(r("prop-types"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.PureComponent),n(t,[{key:"render",value:function(){var e=this.props,t=e.type,r=e.maxSize,n=e.totalNum,a=e.supportSort,u=e.imageUploadServerHost,l=e.imageShowServiceHost,s=e.extraParam,f=e.getSign,c=e.value,d=e.onChange;return o.default.createElement(i.default,{type:t,value:c,maxSize:r,totalNum:n,supportSort:a,getSign:f,extraParam:s,imageUploadServerHost:u,imageShowServiceHost:l,onChange:d})}}]),t}();s.defaultProps={type:"oss"},t.default=s,s.propTypes={type:u.default.string,maxSize:u.default.number,totalNum:u.default.number,supportSort:u.default.bool,imageUploadServerHost:u.default.string,imageShowServiceHost:u.default.string,extraParam:u.default.object,getSign:u.default.func.isRequired,onChange:u.default.func,value:u.default.string}},0:function(e,t,r){e.exports=r("./src/index.js")},"antd/lib/icon":function(e,t){e.exports=require("antd/lib/icon")},"antd/lib/icon/style/css":function(e,t){e.exports=require("antd/lib/icon/style/css")},"antd/lib/message":function(e,t){e.exports=require("antd/lib/message")},"antd/lib/message/style/css":function(e,t){e.exports=require("antd/lib/message/style/css")},"antd/lib/modal":function(e,t){e.exports=require("antd/lib/modal")},"antd/lib/modal/style/css":function(e,t){e.exports=require("antd/lib/modal/style/css")},"antd/lib/upload":function(e,t){e.exports=require("antd/lib/upload")},"antd/lib/upload/style/css":function(e,t){e.exports=require("antd/lib/upload/style/css")},"babel-runtime/regenerator":function(e,t){e.exports=require("babel-runtime/regenerator")},"prop-types":function(e,t){e.exports=require("prop-types")},react:function(e,t){e.exports=require("react")},"react-beautiful-dnd":function(e,t){e.exports=require("react-beautiful-dnd")}})});